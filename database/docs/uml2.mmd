erDiagram
    Roles {
        int id PK
        string name
        int displayOrder
        datetime createdAt
        datetime updatedAt
    }

    Policy {
        int id PK
        string name
        string resource
        string action
        datetime createdAt
        datetime updatedAt
    }

    RolePolicy {
        int roleID FK
        int policyID FK
        datetime createdAt
        datetime updatedAt
    }

    User {
        int id PK
        string firstName
        string lastName
        string email
        int roleId FK
        string status
        string apiKey
        float budget
        float remaining
        datetime createdAt
        datetime updatedAt
    }

    Providers {
        int id PK
        string name
        string apiKey
        string endpoint
        datetime createdAt
        datetime updatedAt
    }

    Model {
        int id PK
        string name
        string type
        string description
        int providerId FK
        string internalName
        int summarizeThreshold
        jsonb defaultParameters
        int maxContext
        int maxOutput
        int maxReasoning
        float cost1kInput
        float cost1KOutput
        float cost1kCacheReason
        float cost1kCacheWrite
        datetime createdAt
        datetime updatedAt
    }

    Prompt {
        int id PK
        int agentID FK
        int version
        string content
        string name
        datetime createdAt
        datetime updatedAt
    }

    Agent {
        int id PK
        string name
        string description
        int promptId FK
        int modelID FK
        jsonb modelParameters
        int creatorID FK
        datetime createdAt
        datetime updatedAt
    }

    Conversation {
        int id PK
        int agentID FK
        int userID FK
        boolean deleted
        datetime deletedAt
        string title
        int latestSummarySN
        datetime createdAt
        datetime updatedAt
    }

    Message {
        int id PK
        int conversationID FK
        int serialNumber
        string role
        jsonb content
        int tokens
        datetime createdAt
        datetime updatedAt
    }

    Tool {
        int id PK
        string name
        string description
        string type
        string authenticationType
        string endpoint
        string transportType
        jsonb customConfig
        datetime createdAt
        datetime updatedAt
    }

    Resource {
        int id PK
        int toolID FK
        int conversationID FK
        int messageID FK
        string name
        string description
        jsonb metadata
        string s3Uri
        string MIMEType
        string content
        datetime createdAt
        datetime updatedAt
    }

    Vector {
        int id PK
        int toolID FK
        int resourceID FK
        int order
        jsonb embedding
        string content
        int conversationID FK
        datetime createdAt
        datetime updatedAt
    }

    UserAgent {
        int userID FK
        int agentID FK
        string role
        datetime createdAt
        datetime updatedAt
    }

    UserTool {
        int userID FK
        int toolID FK
        jsonb credential
        datetime createdAt
        datetime updatedAt
    }

    AgentTool {
        int toolID FK
        int agentID FK
        datetime createdAt
        datetime updatedAt
    }

    Usages {
        int id PK
        string type
        int userID FK
        int agentID FK
        int messageID FK
        int modelId FK
        float inputTokens
        float outputtokens
        float cacheReadToken
        float cacheWriteToken
        float cost
        datetime createdAt
        datetime updatedAt
    }

    Sessions {
        string sid PK
        datetime expires
        string data
        datetime createdAt
        datetime updatedAt
    }

    %% Access Management
    Roles ||--o{ User : "roleId"
    Roles ||--o{ RolePolicy : "roleID"
    Policy ||--o{ RolePolicy : "policyID"

    %% AI Configuration
    Providers ||--o{ Model : "providerId"
    Model ||--o{ Agent : "modelID"
    Prompt ||--o{ Agent : "promptId"
    User ||--o{ Agent : "creatorID"

    %% Conversations
    Agent ||--o{ Conversation : "agentID"
    User ||--o{ Conversation : "userID"
    Conversation ||--o{ Message : "conversationID"

    %% Resources & Vectors
    Tool ||--o{ Resource : "toolID"
    Conversation ||--o{ Resource : "conversationID"
    Message ||--o{ Resource : "messageID"
    Tool ||--o{ Vector : "toolID"
    Resource ||--o{ Vector : "resourceID"
    Conversation ||--o{ Vector : "conversationID"

    %% Join Tables
    User ||--o{ UserAgent : "userID"
    Agent ||--o{ UserAgent : "agentID"
    User ||--o{ UserTool : "userID"
    Tool ||--o{ UserTool : "toolID"
    Tool ||--o{ AgentTool : "toolID"
    Agent ||--o{ AgentTool : "agentID"

    %% Metrics
    User ||--o{ Usages : "userID"
    Agent ||--o{ Usages : "agentID"
    Message ||--o{ Usages : "messageID"
    Model ||--o{ Usages : "modelId"
