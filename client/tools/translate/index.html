<!DOCTYPE html>
<html lang="en">
  <head>
    <base href=".." />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI in Research and Translational Informatics</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link rel="stylesheet" href="/styles.css" />
    <script src="/components/app-header.js" type="module"></script>
    <script src="/components/app-footer.js" type="module"></script>
  </head>
  <body class="d-flex flex-column vh-100">

    <app-header subtitle="Research Optimizer"></app-header>

    <main class="container flex-grow-1 py-3">

      <form id="translateForm" class="row">
        <div class="col-md-6">
            <label for="inputText" class="form-label mt-2">Text To Translate</label>
            <textarea class="form-control" id="inputText" rows="10" placeholder="Enter text to translate"></textarea>
            <label for="sourceLanguage" class="form-label mt-2">Select Source Language</label>
            <select class="form-select" name="sourceLanguage" data-options="translate-languages" value="en">
                <option value="" disabled selected>Select a source language</option>
            </select>

            <button class="btn btn-primary mt-2" id="translateButton" type="submit">Translate</button>
        </div>
        <div class="col-md-6">
            <label for="translationResult" class="form-label mt-2">Translated Text</label>
            <textarea class="form-control" id="translationResult" rows="10" placeholder="Submit text to view translation results" readonly></textarea>
            
            <label for="targetLanguage" class="form-label mt-2">Select Target Language</label>
            <select class="form-select" name="targetLanguage" data-options="translate-languages" value="es">
                <option value="" disabled selected>Select a target language</option>
            </select>

        </div>
      </form>
    </main>
    <app-footer></app-footer>
    <script type="module">
        translateForm.onsubmit = handleSubmit;
        await populateOptions();

        async function populateOptions(querySelector = '[data-options="translate-languages"]') {
            const elements = document.querySelectorAll(querySelector);

            const languages = await getLanguages();

            // Clear existing options
            elements.forEach((element) => {
                element.innerHTML = '';
            });
            elements.forEach((element) => {
                const initialValue = element.getAttribute('value');
                languages.forEach((language) => {
                    const option = document.createElement('option');
                    option.value = language.LanguageCode;
                    option.textContent = language.LanguageName;
                    if (language.LanguageCode === initialValue) {
                        option.selected = true;
                    }
                    element.appendChild(option);
                });
            });
        }

        async function getLanguages() {
            const response = await fetch('/api/translate/languages');
            return await response.json();   
        }

        async function handleSubmit(event) {
            event.preventDefault();
            const form = event.target;
            const text = form.inputText.value;
            const sourceLanguage = 'en';
            const targetLanguage = 'es';


            translationResult.innerHTML = '';

            // Call the translation API
            try {
                const response = await fetch('/api/translate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ text, sourceLanguage, targetLanguage })
                });

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const data = await response.json();
                translationResult.innerHTML = data;
            } catch (error) {
                translationResult.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        }

    </script>
  </body>
</html>
